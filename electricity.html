<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electricity Department | SD Edition</title>
    <style>
        :root { 
            --bg: #0f172a; --card: #1e293b; --text: #f8fafc; 
            --cyan: #22d3ee; /* Wasubijwe kuri Cyan */
            --green: #4ade80; --yellow: #fbbf24; --red: #f87171; 
            --border: #334155; 
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 50px; }
        nav { background: var(--card); padding: 0 15px; display: flex; justify-content: center; gap: 10px; border-bottom: 2px solid var(--cyan); position: sticky; top: 0; z-index: 100; }
        nav a { color: var(--text); text-decoration: none; font-weight: bold; padding: 15px 25px; cursor: pointer; font-size: 14px; }
        nav a.active { background: var(--cyan); color: #000; }
        .page-section { display: none; padding: 30px 20px; max-width: 1400px; margin: auto; }
        .page-section.active { display: block; }
        .level-header { background: var(--cyan); color: #000; padding: 10px 20px; border-radius: 8px 8px 0 0; display: inline-block; font-weight: 800; text-transform: uppercase; }
        .table-container { background: var(--card); padding: 10px; border-radius: 0 10px 10px 10px; border: 1px solid var(--border); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 1200px; }
        th, td { padding: 12px 8px; border-bottom: 1px solid var(--border); text-align: center; font-size: 13px; }
        th { background: #334155; color: var(--cyan); }
        .term-sep { border-left: 2px solid var(--border); }
        .st-PAID { color: var(--green); font-weight: bold; }
        .st-OVER-PAID { background: var(--cyan); color: #000; padding: 2px 8px; border-radius: 4px; font-weight: 900; }
        .st-NOT-ENOUGH-MONEY { color: var(--yellow); font-weight: bold; }
        .st-NOT-PAID { color: var(--red); font-weight: bold; }
        .form-box { max-width: 500px; margin: 40px auto; background: var(--card); padding: 30px; border-radius: 15px; border: 1px solid var(--border); }
        input, select { width: 100%; padding: 12px; margin: 10px 0; background: #0f172a; border: 1px solid var(--border); color: white; border-radius: 8px; }
        .btn { width: 100%; padding: 14px; background: var(--cyan); color: #000; border: none; font-weight: bold; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

<nav>
    <a onclick="show('home')" id="n-home" class="active">ELECTRICITY LIST</a>
    <a onclick="show('new')" id="n-new">ADD STUDENT</a>
    <a onclick="show('update')" id="n-update">PAYMENTS</a>
    <a onclick="show('dash')" id="n-dash">DASHBOARD</a>
</nav>

<section id="home" class="page-section active">
    <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <h2 style="margin:0;">ELECTRICITY DEPARTMENT âš¡</h2>
        <input type="text" id="search" onkeyup="render()" placeholder="ðŸ” Search name..." style="width: 300px;">
    </div>
    <div id="list"></div>
</section>

<section id="new" class="page-section">
    <div class="form-box">
        <h2>Register Electricity Student</h2>
        <form id="fs-form" action="https://formspree.io/f/xreazkkj" method="POST">
            <input type="email" name="email" placeholder="Student Email" required>
            <input type="text" id="regName" name="Student Name" placeholder="Full Name" required>
            <select id="regLvl" name="Level">
                <option value="Level 3">Level 3 (150,000/Term)</option>
                <option value="Level 4">Level 4 (150,000/Term)</option>
                <option value="Level 5">Level 5 (150,000/Term)</option>
            </select>
            <select id="regTerm" name="Start Term">
                <option value="1">Term 1</option>
                <option value="2">Term 2</option>
                <option value="3">Term 3</option>
            </select>
            <input type="number" id="regMoney" name="Initial Pay" placeholder="Initial Payment (RWF)">
            <button type="submit" class="btn" id="fs-submit">SAVE & SEND EMAIL</button>
        </form>
    </div>
</section>

<section id="update" class="page-section">
    <div class="form-box">
        <h2>Submit Payment</h2>
        <select id="selStudent"></select>
        <input type="number" id="amt" placeholder="Enter amount" style="text-align: center; font-size: 24px;">
        <button class="btn" onclick="pay()">CONFIRM TRANSACTION</button>
    </div>
</section>

<section id="dash" class="page-section">
    <div style="display: flex; gap: 20px;">
        <div class="form-box" style="flex:1; text-align:center;"><h3>TOTAL REVENUE</h3><h1 id="d-col" style="color:var(--green)">0</h1></div>
        <div class="form-box" style="flex:1; text-align:center;"><h3>TOTAL DEBT</h3><h1 id="d-debt" style="color:var(--red)">0</h1></div>
    </div>
</section>

<script>
    const getFee = (lvl) => 150000;
    
    let students = JSON.parse(localStorage.getItem('electricity_db_v1')) || [
        {name: "GAKURU Olivier", level: "Level 3", paidTotal: 450000},
        {name: "MUGABE Christian", level: "Level 3", paidTotal: 150000},
        {name: "UWIZEYE Alice", level: "Level 3", paidTotal: 200000},
        {name: "BIZIMANA AimÃ©", level: "Level 3", paidTotal: 0},
        {name: "TUMUKUNDE Hope", level: "Level 3", paidTotal: 500000},
        {name: "NSANZIMANA Jean", level: "Level 4", paidTotal: 300000},
        {name: "KALISA Bruno", level: "Level 4", paidTotal: 100000},
        {name: "UMUHOZA Lea", level: "Level 4", paidTotal: 150000},
        {name: "RWAMAGANA Theo", level: "Level 4", paidTotal: 250000},
        {name: "NDOLI Jules", level: "Level 4", paidTotal: 50000},
        {name: "MUNEZA Pacifique", level: "Level 5", paidTotal: 450000},
        {name: "MUTONI Carine", level: "Level 5", paidTotal: 150000},
        {name: "KAYITESI Peace", level: "Level 5", paidTotal: 0},
        {name: "NIYIGENA Gentille", level: "Level 5", paidTotal: 220000},
        {name: "SHIMWA Cedric", level: "Level 5", paidTotal: 550000}
    ];

    function save() { localStorage.setItem('electricity_db_v1', JSON.stringify(students)); }

    function calc(s, extra) {
        s.paidTotal += extra;
        let rem = s.paidTotal;
        const fee = getFee(s.level);
        s.t1={}; s.t2={}; s.t3={};
        [s.t1, s.t2, s.t3].forEach((t, i) => {
            if (rem >= fee) {
                if (i === 2) { t.p = rem; t.s = (rem > fee) ? "OVER PAID" : "PAID"; t.b = (rem > fee) ? "+" + (rem - fee).toLocaleString() : 0; }
                else { t.p = fee; t.s = "PAID"; t.b = 0; rem -= fee; }
            } else if (rem > 0) { t.p = rem; t.s = "NOT ENOUGH MONEY"; t.b = (fee - rem).toLocaleString(); rem = 0; }
            else { t.p = 0; t.s = "NOT PAID"; t.b = fee.toLocaleString(); }
        });
        save();
    }

    students.forEach(s => { let c = s.paidTotal; s.paidTotal = 0; calc(s, c); });

    function render() {
        const q = document.getElementById('search').value.toLowerCase();
        const container = document.getElementById('list');
        container.innerHTML = "";
        ["Level 3", "Level 4", "Level 5"].forEach(lvl => {
            let filtered = students.filter(s => s.level === lvl && s.name.toLowerCase().includes(q));
            if(filtered.length > 0) {
                const fee = getFee(lvl);
                let html = `<div class="level-header">${lvl}</div><div class="table-container"><table>
                    <thead><tr><th rowspan="2">Student Name</th><th colspan="4" class="term-sep">Term 1</th><th colspan="4" class="term-sep">Term 2</th><th colspan="4" class="term-sep">Term 3</th></tr>
                    <tr><th class="term-sep">Fee</th><th>Paid</th><th>Bal</th><th>Status</th><th class="term-sep">Fee</th><th>Paid</th><th>Bal</th><th>Status</th><th class="term-sep">Fee</th><th>Paid</th><th>Bal</th><th>Status</th></tr></thead><tbody>`;
                filtered.forEach(s => {
                    html += `<tr><td style="text-align:left; font-weight:bold;">${s.name}</td>
                        <td class="term-sep">${fee.toLocaleString()}</td><td>${s.t1.p.toLocaleString()}</td><td>${s.t1.b}</td><td><span class="st-${s.t1.s.replace(/ /g, '-')}">${s.t1.s}</span></td>
                        <td class="term-sep">${fee.toLocaleString()}</td><td>${s.t2.p.toLocaleString()}</td><td>${s.t2.b}</td><td><span class="st-${s.t2.s.replace(/ /g, '-')}">${s.t2.s}</span></td>
                        <td class="term-sep">${fee.toLocaleString()}</td><td>${s.t3.p.toLocaleString()}</td><td>${s.t3.b}</td><td><span class="st-${s.t3.s.replace(/ /g, '-')}">${s.t3.s}</span></td></tr>`;
                });
                container.innerHTML += html + "</tbody></table></div>";
            }
        });
        fillSelect();
    }

    function show(id) {
        document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('n-' + id).classList.add('active');
        if(id === 'dash') {
            let col = 0, debt = 0;
            students.forEach(s => { 
                col += s.paidTotal; 
                [s.t1,s.t2,s.t3].forEach(t => { 
                    let b = (typeof t.b === 'string' && t.b.includes('+')) ? 0 : (typeof t.b === 'string' ? parseInt(t.b.replace(/,/g, '')) : t.b);
                    if(b > 0) debt += b;
                });
            });
            document.getElementById('d-col').innerText = col.toLocaleString() + " RWF";
            document.getElementById('d-debt').innerText = debt.toLocaleString() + " RWF";
        }
    }

    function pay() {
        let name = document.getElementById('selStudent').value;
        let val = parseInt(document.getElementById('amt').value);
        if(!name || isNaN(val)) return;
        let s = students.find(x => x.name === name);
        calc(s, val); render(); show('home');
        document.getElementById('amt').value = "";
    }

    function fillSelect() {
        const sel = document.getElementById('selStudent');
        sel.innerHTML = '<option value="">-- Choose Student --</option>';
        students.sort((a,b) => a.name.localeCompare(b.name)).forEach(s => {
            sel.innerHTML += `<option value="${s.name}">${s.name} (${s.level})</option>`;
        });
    }

    document.getElementById("fs-form").addEventListener("submit", function(e) {
        e.preventDefault();
        let n = document.getElementById('regName').value;
        let l = document.getElementById('regLvl').value;
        let t = parseInt(document.getElementById('regTerm').value);
        let m = parseInt(document.getElementById('regMoney').value) || 0;
        let s = { name: n, level: l, paidTotal: 0 };
        calc(s, ((t - 1) * getFee(l)) + m);
        students.push(s); 
        save(); render(); show('home');
        alert("Electricity Student Saved!");
    });

    render();
</script>
</body>
</html>